<dom-module id="qbert-exec">
  <script>
    'use strict'
    Polymer({
      is: 'qbert-exec',

      hostAttributes: {
        hidden: true
      },

      properties: {
        cmd: {
          type: String,
          value: ''
        },
        interval: {
          type: Number,
          value: 0
        },
        stdout: {
          type: String,
          notify: true
        },
        stderr: {
          type: String,
          notify: true
        },
        as: {
          type: String,
          value: 'text'
        }
      },

      ready: function() {
        if(this.cmd == '') {
          return
        }

        this.execute()

        if(this.interval >= 1) {
          window.setInterval(this.execute.bind(this), this.interval * 1000)
        }
      },

      nodeExec: require('child_process').exec,

      execute: function() {

        this.nodeExec(this.cmd, (error, stdout, stderr) => {
          if (error !== null) {
            console.log(`qbert-exec error: ${error}`)

            return
          }

          this.stdout = this.as == 'lines' ? stdout.split('\n') : stdout
          this.stderr = stderr
        })
      }
    })
  </script>
</dom-module>
